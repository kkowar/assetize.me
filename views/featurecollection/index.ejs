<div id="layerContainer" class="container">
	<div class="col-md-12">
		<!-- <h3>TODO: Search, Tags, Filters</h3> -->
    <div>&nbsp;</div>
    <span class="btn btn-success fileinput-button">
        <i class="glyphicon glyphicon-plus"></i>
        <span>Add a Feature Collection</span>
        <!-- The file input field used as target for the file upload widget -->
        <input id="fileupload" type="file" name="files[]" multiple="">
    </span>
	</div>
	<div class="col-md-12">
    <div>
      <table id="meter_records" class="table table-striped table-hover">
        <thead>
          <tr>
            <th style="white-space: nowrap;">Name</th>
            <th>Type</th>
            <th>Count</th>
            <th>Created At</th>
            <th>Updated at</th>
            <th>Actions</th>
          </tr>
        </thead>
      	<tbody>
          <% _.each(featureCollections,function(fc){ %>
            <tr id="feature_collection_<%= fc.id %>" class="feature_collection">
                <td class="location_code"><a href="/table/<%= fc.id %>?"><%= fc.name %></a></td>
                <td><%= fc.geometryType %></td>
                <td><span class="badge"><%= fc.totalFeatures %></span></td>
                <td><%= fc.createdAt %></td>
                <td><%= fc.updatedAt %></td>
                <td><span id="fc_<%= fc.id %>" class="glyphicon glyphicon-remove remove-featureClass" style="color: red;"></span></td>
            </tr>
          <% }); %>
        </tbody>
      </table>
    </div>
	</div>
</div>
<script>
/*jslint unparam: true */
/*global window, $ */
$(document).ready(function() {
    'use strict';
    $('#fileupload').fileupload({
        url: 'featurecollection/create',
        dataType: 'json',
        done: function (e, data) {
            // $.each(data.result.files, function (index, file) {
            //     $('<p/>').text(file.name).appendTo('#files');
            // });
        },
        progressall: function (e, data) {
            // var progress = parseInt(data.loaded / data.total * 100, 10);
            // $('#progress .progress-bar').css(
            //     'width',
            //     progress + '%'
            // );
        }
    });

  $(document).on("click touchend",".remove-featureClass",function (e) {
    e.preventDefault();
    var fcID = (e.currentTarget.id).split("_")[1];
    $.ajax({url: "featurecollection/destroy/" + fcID}).done(function(data){
      $("#fc_" + fcID).parent().parent().remove();
      // todo: some sort of callback to refresh the screen.
    });    
  });
});
</script>